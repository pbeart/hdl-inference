import pickle
import mlgen
import fp as fp
import hdlgen
import argparse, os

from dataclasses import dataclass

parser = argparse.ArgumentParser(description='Process some images')
parser.add_argument("model", help="the input .mlgen array")
#parser.add_argument("input", help="comma-separated list of inputs")


float_environment = fp.FloatEnvironment("binary16")

args = parser.parse_args()

f = open(args.model, "rb")
mlgen_model: mlgen.Model = pickle.load(f)
f.close()

#last_layer = [float(x) for x in args.input.split(",")]

last_layer = [-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.258611,1.026908,1.026908,1.026908,-0.105876,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.835989,2.490618,2.796088,2.808815,2.796088,1.128731,0.543247,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.708710,2.096053,2.643353,2.796088,2.796088,2.490618,2.312427,2.796088,1.510569,-0.093148,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.182244,0.950541,2.223332,2.796088,2.719720,2.236060,0.645071,0.174138,0.543247,2.719720,2.554257,0.046859,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,1.726943,2.796088,2.808815,2.796088,1.077820,-0.424074,-0.424074,-0.424074,-0.424074,1.103275,2.643353,1.370562,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.670527,2.808815,2.808815,2.821543,1.383290,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,1.306922,2.808815,1.803311,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.059587,2.376067,2.796088,2.796088,2.197876,-0.220427,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,1.905134,2.796088,1.192371,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.334979,0.301417,1.408745,2.796088,2.630625,1.879678,-0.105876,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.182244,2.248787,2.719720,0.683254,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.148682,2.796088,2.808815,2.681536,1.790583,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.263233,2.401522,2.236060,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,1.739671,2.796088,2.821543,2.325155,-0.029509,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,2.452434,2.796088,1.637848,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.301417,2.808815,2.808815,1.383290,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,2.032413,2.808815,2.096053,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.054964,2.134236,2.796088,2.796088,0.785078,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.296795,0.657799,2.617897,2.796088,0.479608,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,2.057869,2.796088,2.719720,1.077820,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.339601,2.796088,2.821543,1.548752,-0.258611,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.390512,2.643353,2.796088,2.439706,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.059587,2.452434,2.796088,1.854222,-0.309523,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.390512,2.643353,2.796088,1.434201,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.186866,1.688759,2.592441,1.001452,0.377784,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,1.026908,2.821543,2.490618,0.174138,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,1.828766,2.808815,2.490618,0.174138,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,1.026908,2.796088,2.312427,-0.054964,-0.424074,-0.424074,-0.054964,0.657799,0.861445,2.452434,2.808815,2.439706,0.237777,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,1.408745,2.796088,2.796088,2.325155,2.096053,2.108780,2.325155,2.796088,2.719720,2.070597,1.281466,0.046859,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.657799,2.363339,2.796088,2.796088,2.796088,2.808815,2.681536,2.439706,2.121508,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,0.059587,1.001452,1.001452,1.001452,1.014180,0.530519,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074,-0.424074]

for layer_index, layer in enumerate(mlgen_model.layers):
    last_layer = layer.eval(last_layer)
    print(f"Got layer {[f'{float(x):.2f}' for x in last_layer[:9]]}")

print(last_layer)